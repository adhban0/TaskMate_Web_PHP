<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaskMate â€” Calendar</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Font Awesome (optional) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    body { background: #f6f7fb; }
    .card { border: 0; border-radius: 16px; }
    .shadow-soft { box-shadow: 0 10px 30px rgba(0,0,0,.06); }
    .text-muted-2 { color: #6b7280; }

    .form-control:focus, .form-select:focus {
      box-shadow: 0 0 0 .2rem rgba(17, 24, 39, .08);
      border-color: rgba(17, 24, 39, .25);
    }

    /* Calendar grid */
    .cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }
    .cal-dow {
      font-size: .85rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: .04em;
      text-align: center;
      padding: 6px 0;
    }
    .cal-day {
      background: #fff;
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 14px;
      min-height: 120px;
      padding: 10px;
      position: relative;
    }
    .cal-day.muted {
      background: rgba(255,255,255,.55);
      color: #9ca3af;
    }
    .cal-day .num {
      font-weight: 700;
      font-size: .95rem;
      color: #111827;
    }
    .cal-day.muted .num { color: #9ca3af; }
    .cal-day.today {
      outline: 2px solid rgba(17,24,39,.20);
      outline-offset: 2px;
    }

    /* Event chips */
    .chip {
      display: flex;
      align-items: center;
      gap: .45rem;
      border-radius: 999px;
      padding: .25rem .55rem;
      font-size: .82rem;
      margin-top: 8px;
      border: 1px solid rgba(0,0,0,.08);
      background: #fff;
      color: #111827;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .dot {
      width: 10px; height: 10px; border-radius: 50%;
      flex: 0 0 auto;
      background: #111827;
    }

    /* Small pill labels */
    .pill {
      border: 1px solid rgba(0,0,0,.10);
      background: #fff;
      border-radius: 999px;
      padding: .35rem .6rem;
      font-size: .85rem;
      color: #111827;
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <!-- Top Navbar (matches other pages) -->
 

  <main class="container my-4">
    <!-- Header -->
    <div class="d-flex flex-wrap justify-content-between align-items-end gap-2 mb-3">
      <div>
        <h2 class="mb-1">Calendar</h2>
        <div class="text-muted-2">Plan your week, track events, and stay on schedule.</div>
      </div>
      <div class="text-end">
        <div class="small text-muted-2">Today</div>
        <div class="fw-semibold" id="todayDate">â€”</div>
      </div>
    </div>

    <div class="row g-3">
      <!-- Left: Month view -->
      <div class="col-12 col-lg-8">
        <div class="card shadow-soft">
          <div class="card-body">
            <!-- Calendar toolbar -->
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
              <div class="d-flex align-items-center gap-2">
                <button class="btn btn-outline-secondary" id="prevBtn" title="Previous month">
                  <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button class="btn btn-outline-secondary" id="nextBtn" title="Next month">
                  <i class="fa-solid fa-chevron-right"></i>
                </button>
                <button class="btn btn-dark" id="todayBtn">
                  <i class="fa-regular fa-calendar-check me-2"></i>Today
                </button>
              </div>

              <div class="d-flex align-items-center gap-2">
                <div class="pill">
                  <i class="fa-regular fa-calendar me-1"></i>
                  <span id="monthTitle">â€”</span>
                </div>

                
              </div>
            </div>

            <!-- Days of week -->
            <div class="cal-grid mb-2">
              <div class="cal-dow">Sun</div>
              <div class="cal-dow">Mon</div>
              <div class="cal-dow">Tue</div>
              <div class="cal-dow">Wed</div>
              <div class="cal-dow">Thu</div>
              <div class="cal-dow">Fri</div>
              <div class="cal-dow">Sat</div>
            </div>

            <!-- Calendar grid -->
            <div class="cal-grid" id="calGrid">
              <!-- Filled by JS -->
            </div>

            
          </div>
        </div>
      </div>

      <!-- Right: Agenda / Selected day -->
      <div class="col-12 col-lg-4">
        <div class="card shadow-soft mb-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="mb-0">Agenda</h5>
              <span class="badge text-bg-dark">This week</span>
            </div>

            <div class="list-group list-group-flush">
              <div class="list-group-item bg-transparent px-0">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Team check-in</div>
                    <div class="small text-muted-2">Today â€¢ 8:30 PM</div>
                  </div>
                </div>
              </div>

              <div class="list-group-item bg-transparent px-0">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Study block (Algorithms)</div>
                    <div class="small text-muted-2">Tue â€¢ 6:00 PM</div>
                  </div>
                </div>
              </div>

              <div class="list-group-item bg-transparent px-0">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Client call</div>
                    <div class="small text-muted-2">Wed â€¢ 5:00 PM</div>
                  </div>
                </div>
              </div>

              <div class="list-group-item bg-transparent px-0">
                <div class="d-flex justify-content-between">
                  <div>
                    <div class="fw-semibold">Maintenance window</div>
                    <div class="small text-muted-2">Thu â€¢ 11:00 PM</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-grid mt-3">
              <button class="btn btn-outline-dark" id="agendaAddBtn">
  <i class="fa-solid fa-plus me-2"></i>Add event
</button>

            </div>
          </div>
        </div>

        
      </div>
    </div>
  </main>

  <!-- Add Event Modal -->
  <!-- Add Event Modal -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 16px; border: 0;">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="eventModalTitle">Add event</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body pt-0">
        <!-- mode + key (used when editing) -->
        <input type="hidden" id="eventMode" value="create" />
        <input type="hidden" id="eventKey" value="" /> <!-- YYYY-MM-DD|index -->

        <div class="mb-2">
          <label class="form-label small text-muted-2 mb-1">Title</label>
          <input id="eventTitle" class="form-control" placeholder="e.g., Client call" />
        </div>

        <div class="row g-2">
          <div class="col-6">
            <label class="form-label small text-muted-2 mb-1">Date</label>
            <input id="eventDate" type="date" class="form-control" />
          </div>
          <div class="col-6">
            <label class="form-label small text-muted-2 mb-1">Time</label>
            <input id="eventTime" type="time" class="form-control" />
          </div>
        </div>

        <div class="mt-2">
          <label class="form-label small text-muted-2 mb-1">Notes (optional)</label>
          <textarea id="eventNotes" class="form-control" rows="3" placeholder="Add details..."></textarea>
        </div>

        <div class="d-grid mt-3">
          <button class="btn btn-dark" id="eventSaveBtn" type="button">
            <i class="fa-solid fa-plus me-2"></i><span id="eventSaveText">Create event</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const calGrid = document.getElementById("calGrid");
  const monthTitle = document.getElementById("monthTitle");
  const todayDate = document.getElementById("todayDate");

  // Modal elements
  const addEventModalEl = document.getElementById("addEventModal");
  const addEventModal = new bootstrap.Modal(addEventModalEl);

  const eventModalTitle = document.getElementById("eventModalTitle");
  const eventMode = document.getElementById("eventMode");
  const eventKey = document.getElementById("eventKey");

  const eventTitle = document.getElementById("eventTitle");
  const eventDate  = document.getElementById("eventDate");
  const eventTime  = document.getElementById("eventTime");
  const eventNotes = document.getElementById("eventNotes");

  const eventSaveBtn = document.getElementById("eventSaveBtn");
  const eventSaveText = document.getElementById("eventSaveText");

  // Demo events (now includes time + notes so edit makes sense)
  // Key format: YYYY-MM-DD
  const events = {
    "2026-01-26": [
      { title: "Team check-in", type: "Meeting", time: "20:30", notes: "" },
    ],
    "2026-01-28": [
      { title: "Client call", type: "Work", time: "17:00", notes: "" },
    ],
    "2026-01-29": [
      { title: "Maintenance", type: "Ops", time: "23:00", notes: "Prepare checklist" },
    ]
  };

  const typeDot = () => '<span class="dot"></span>';
// Creates a Date object for the current date & time
  let view = new Date();
// Converts a number into a 2-digit string
// Adds a leading 0 if needed
  function pad(n){ return String(n).padStart(2,"0"); }
//   Takes a Date object d

// Returns a string in YYYY-MM-DD format

// ðŸ”¹ Key details:

// getMonth() starts at 0 â†’ January = 0
// ðŸ‘‰ so we add +1
  function ymd(d){
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }

  function renderTodayLabel(){
    const d = new Date();
    todayDate.textContent = d.toLocaleDateString(undefined, {
      weekday: "long", year: "numeric", month: "long", day: "numeric"
    });
  }

  function setModalCreateMode(dateStr){
    eventMode.value = "create";
    eventKey.value = "";

    eventModalTitle.textContent = "Add event";
    eventSaveText.textContent = "Create event";
    eventSaveBtn.querySelector("i").className = "fa-solid fa-plus me-2";

    eventTitle.value = "";
    eventDate.value = dateStr || "";
    eventTime.value = "";
    eventNotes.value = "";
  }

  function setModalEditMode(dateStr, index){
    const ev = (events[dateStr] || [])[index];
    if(!ev) return;

    eventMode.value = "edit";
    eventKey.value = `${dateStr}|${index}`;

    eventModalTitle.textContent = "Edit event";
    eventSaveText.textContent = "Save changes";
    eventSaveBtn.querySelector("i").className = "fa-solid fa-floppy-disk me-2";

    eventTitle.value = ev.title || "";
    eventDate.value = dateStr;
    eventTime.value = ev.time || "";
    eventNotes.value = ev.notes || "";
  }

  function openModalForAdd(dateStr){
    setModalCreateMode(dateStr);
    addEventModal.show();
    // focus title for quick typing
    setTimeout(() => eventTitle.focus(), 150);
  }

  function openModalForEdit(dateStr, index){
    setModalEditMode(dateStr, index);
    addEventModal.show();
    setTimeout(() => eventTitle.focus(), 150);
  }

  function renderCalendar(){
    calGrid.innerHTML = "";

    const year = view.getFullYear();
    const month = view.getMonth();

    monthTitle.textContent = view.toLocaleDateString(undefined, { month: "long", year: "numeric" });
// Creates date for the 1st of the month. 
    const first = new Date(year, month, 1);
//     startDow = day of week (0â€“6) for that first day:
// 0 Sunday, 1 Monday, â€¦ 6 Saturday
    const startDow = first.getDay();
//     day 0 of â€œnext monthâ€ = last day of current month

// So .getDate() gives how many days are in this month (28â€“31).
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    // previous month padding

    // Number of days in the previous month.
    const prevDays = new Date(year, month, 0).getDate();
// Creates the â€œmutedâ€ days before the 1st.

// Example: If the 1st is Thursday, you need Sun/Mon/Tue/Wed from previous month.

// dayCell(cellDate, true) means: build a muted cell.
    for(let i = startDow - 1; i >= 0; i--){
      const dayNum = prevDays - i;
      const cellDate = new Date(year, month - 1, dayNum);
      calGrid.appendChild(dayCell(cellDate, true));
    }
// Adds day 1..end for the current month (not muted).
    // current month
    for(let d = 1; d <= daysInMonth; d++){
      const cellDate = new Date(year, month, d);
      calGrid.appendChild(dayCell(cellDate, false));
    }

    // next month padding (always 6 rows / 42 cells)

    // Checks how many cells are already made, and how many more to reach 42.
    const totalCells = calGrid.children.length;
    const remaining = 42 - totalCells;
    // Adds muted cells from next month to fill the grid.
    for(let d = 1; d <= remaining; d++){
      const cellDate = new Date(year, month + 1, d);
      calGrid.appendChild(dayCell(cellDate, true));
    }
  }

  function dayCell(dateObj, isMuted){
    const div = document.createElement("div");
    div.className = "cal-day" + (isMuted ? " muted" : "");

//     Detects if this cellâ€™s date is today.

// If yes, and itâ€™s not muted, add the today class (highlight).
    const today = new Date();
    const isToday = dateObj.toDateString() === today.toDateString();
    if(isToday && !isMuted) div.classList.add("today");

    const key = ymd(dateObj);
// data-date="${key}" stores the date for that day
    div.innerHTML = `
      <div class="d-flex justify-content-between align-items-start">
        <div class="num">${dateObj.getDate()}</div>
        <button
          class="btn btn-sm btn-outline-secondary py-0 px-2"
          title="Add"
          data-action="add"
          data-date="${key}">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
    `;

    const dayEvents = events[key] || [];
    // Takes only first 3 events (slice = Takes a copy of part of the array) and loops them.
    // e -> object. idx -> index of object
    dayEvents.slice(0, 3).forEach((e, idx) => {
      const chip = document.createElement("button");
      chip.type = "button";
      chip.className = "chip text-start";
      chip.setAttribute("data-action", "edit");
      chip.setAttribute("data-date", key);
      // data-index is which event in that dayâ€™s array.
      chip.setAttribute("data-index", String(idx));
      // Shows dot + event title
      chip.innerHTML = `${typeDot()}<span class="text-truncate">${e.title}</span>`;
      div.appendChild(chip);
    });
// â€œ+X moreâ€ if there are more than 3
    if(dayEvents.length > 3){
      const more = document.createElement("div");
      more.className = "small text-muted-2 mt-2";
      more.textContent = `+${dayEvents.length - 3} more`;
      div.appendChild(more);
    }

    return div;
  }

  // (1) + button and (2) chip click handling (event delegation)
  calGrid.addEventListener("click", (e) => {
    // It uses .closest("[data-action]") to find the nearest clicked element that has data-action
    const btn = e.target.closest("[data-action]");
    if(!btn) return;

    const action = btn.getAttribute("data-action");
    const dateStr = btn.getAttribute("data-date");

    if(action === "add"){
      openModalForAdd(dateStr);
    }

    if(action === "edit"){
      const index = Number(btn.getAttribute("data-index"));
      openModalForEdit(dateStr, index);
    }
  });
document.getElementById("agendaAddBtn").addEventListener("click", () => {
  // optional: default to todayâ€™s date
  const todayStr = ymd(new Date());
  setModalCreateMode(todayStr);
  addEventModal.show();
});

  // Save (create/edit)
  eventSaveBtn.addEventListener("click", () => {
    const title = eventTitle.value.trim();
    const dateStr = eventDate.value; // YYYY-MM-DD
    const time = eventTime.value;    // HH:MM
    const notes = eventNotes.value.trim();

    if(!title){
      eventTitle.focus();
      return;
    }
    if(!dateStr){
      eventDate.focus();
      return;
    }

    if(eventMode.value === "create"){
//       Ensures there is an array for that date.

// Adds a new event object.
      if(!events[dateStr]) events[dateStr] = [];
      events[dateStr].push({
        title,
        type: "General",
        time: time || "",
        notes: notes || ""
      });
    } else {
      // Splits "YYYY-MM-DD|index" into oldDate and idx.
      const [oldDate, idxStr] = eventKey.value.split("|");
      const idx = Number(idxStr);

      const ev = (events[oldDate] || [])[idx];
      if(!ev) return;

      // if date changed, move event
      if(oldDate !== dateStr){
        // remove from old date (take 1 element starting at index) (âš ï¸ splice MUTATES the array)
        events[oldDate].splice(idx, 1);
        if(events[oldDate].length === 0) delete events[oldDate];

        // add to new date
        if(!events[dateStr]) events[dateStr] = [];
        events[dateStr].push(ev);
      }

      ev.title = title;
      ev.time = time || "";
      ev.notes = notes || "";
    }

    addEventModal.hide();
    renderCalendar();
  });

  // Toolbar
  document.getElementById("prevBtn").addEventListener("click", () => {
    view = new Date(view.getFullYear(), view.getMonth() - 1, 1);
    renderCalendar();
  });
  document.getElementById("nextBtn").addEventListener("click", () => {
    view = new Date(view.getFullYear(), view.getMonth() + 1, 1);
    renderCalendar();
  });
  document.getElementById("todayBtn").addEventListener("click", () => {
    const t = new Date();
    view = new Date(t.getFullYear(), t.getMonth(), 1);
    renderCalendar();
  });

  renderTodayLabel();
  renderCalendar();
</script>
  
</body>
</html>
